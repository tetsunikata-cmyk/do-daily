<div class="page">
  <div class="page-header">目標実現</div>

  <!-- 今月の目標／テーマ（上の黒い大きな枠） -->
  <div class="black-card">
    <h2>今月の目標</h2>
    <p><%= @user.goal_title.presence || "未設定" %></p>

    <h2 style="margin-top: 16px;">今月のテーマ</h2>
    <p><%= @user.goal_reason.presence || "未設定" %></p>

    <p style="margin-top: 8px; font-size: 12px;">
      ※ 目標の編集は <%= link_to "My page", mypage_path %> から行えます。
    </p>
  </div>

  <!-- 習慣ToDo（チェックリスト部分） -->
  <div class="black-card">
    <h2>習慣ToDo</h2>

    <table class="habits-table">
      <thead>
        <tr>
          <th>カテゴリ</th>
          <th>習慣</th>
          <th>実行したらチェック</th>
        </tr>
      </thead>
      <tbody>
        <% @habits.each do |habit| %>
          <% today_log = habit.habit_logs.find_by(done_on: Date.current) %>
          <tr>
            <td><%= habit.category.presence || "-" %></td>
            <td><%= habit.title %></td>
            <td class="check-cell">
              <% if today_log.present? %>
                <%= button_to "完了済", habit_habit_log_path(habit),
                              method: :delete,
                              class: "check-button done" %>
              <% else %>
                <%= button_to "□", habit_habit_log_path(habit),
                              method: :post,
                              class: "check-button" %>
              <% end %>
            </td>
          </tr>
        <% end %>
      </tbody>
    </table>

    <p class="note">
      ※ 「□」を押すと今日の達成が登録されます。<br>
      ※ 「完了済」を押すと今日の達成が取り消されます。
    </p>

    <p style="margin-top: 8px; font-size: 12px;">
      習慣の追加・編集は
      <%= link_to "こちら（習慣一覧）", habits_path %>
    </p>
  </div>

  <!-- 下ナビ（2×2レイアウト） -->
  <nav class="nav-grid">
    <%= link_to "道しるべを見る", roadmap_path, class: "nav-button" %>
    <%= link_to "振り返りを見る", reviews_path, class: "nav-button" %>
    <%= link_to "My page", mypage_path, class: "nav-button" %>
    <%= link_to "ログアウト", destroy_user_session_path,
                data: { turbo_method: :delete, turbo_confirm: "ログアウトしますか？" },
                class: "nav-button" %>
  </nav>
</div>