<h1>目標実現</h1>

<section style="margin-bottom: 24px;">
  <h2>今月の目標</h2>
  <p><%= @user.goal_title.presence || "未設定" %></p>

  <h2>今月のテーマ</h2>
  <p><%= @user.goal_reason.presence || "未設定" %></p>

  <p>
    <%= link_to "My pageで編集", mypage_path %>
  </p>
</section>

<section style="margin-bottom: 24px;">
  <h2>習慣ToDo</h2>

  <table border="1" cellpadding="6" cellspacing="0" style="width:100%; max-width: 600px;">
    <tr>
      <th>カテゴリ</th>
      <th>習慣</th>
      <th>実行したらチェック</th>
    </tr>

    <% grouped = @habits.group_by(&:category) %>

    <% ["morning", "gap", "night", "other"].each do |cat| %>
      <% next unless grouped[cat]&.any? %>
      <% grouped[cat].each_with_index do |habit, index| %>
        <tr>
          <% if index == 0 %>
            <td rowspan="<%= grouped[cat].size %>">
              <%=
                case cat
                when "morning" then "朝習慣"
                when "gap"     then "隙間習慣"
                when "night"   then "夜習慣"
                else "その他"
                end
              %>
            </td>
          <% end %>

          <td><%= habit.title %></td>
          <td style="text-align: center;">
            <% if habit.done_today? %>
              <%= button_to "☑", habit_habit_log_path(habit),
                            method: :delete %>
            <% else %>
              <%= button_to "□", habit_habit_log_path(habit),
                            method: :post %>
            <% end %>
          </td>
        </tr>
      <% end %>
    <% end %>
  </table>

  <p style="margin-top: 12px;">
    ※ ☑ を押すと今日の達成が取り消し／登録されます
  </p>

  <p style="margin-top: 8px;">
    <%= link_to "習慣の追加・編集はこちら", habits_path %>
  </p>
</section>

<hr>

<nav style="margin-top: 16px;">
  <%= link_to "道しるべを見る", roadmap_path %> |
  <%= link_to "振り返りを見る", reviews_path %> |
  <%= link_to "My page", mypage_path %> |
  <%= link_to "ログアウト", destroy_user_session_path,
              data: { turbo_method: :delete, turbo_confirm: "ログアウトしますか？" } %>
</nav>
