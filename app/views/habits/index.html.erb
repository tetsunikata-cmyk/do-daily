<div class="page">
  <div class="page-header">DO DAILY.</div>

  <!-- タイトル＆ボタン -->
  <div class="black-card">
    <h1 style="margin-bottom: 4px;">Do daily</h1>
    <p>You already know what to do.</p>

    <div class="nav-buttons" style="margin-top: 12px;">
      <%= link_to "My page", mypage_path, class: "nav-button" %>
      <%= link_to "New Habit", new_habit_path, class: "nav-button" %>
    </div>
  </div>

  <!-- 習慣カード一覧 -->
  <% @habits.each do |habit| %>
    <% today_log = habit.habit_logs.find_by(done_on: Date.current) %>
    <% streak_days =
         if habit.respond_to?(:current_streak)
           habit.current_streak
         else
           habit.habit_logs.count
         end %>

    <div class="black-card">
      <h2><%= habit.title %></h2>

      <p class="habit-note">
        <%= habit.description.presence || "特になし" %>
      </p>

      <div class="habit-actions">
        <% if today_log.present? %>
          <span>Done today ✅</span>
          <%= button_to "Undo",
                habit_habit_log_path(habit),
                method: :delete,
                class: "check-button done" %>
        <% else %>
          <%= button_to "Do today",
                habit_habit_log_path(habit),
                method: :post,
                class: "check-button" %>
        <% end %>
      </div>

      <p class="habit-streak">
        Streak: <%= streak_days %> days
      </p>

      <div class="habit-links">
        <%= link_to "Edit", edit_habit_path(habit) %> |
        <%= link_to "Delete",
              habit_path(habit),
              data: { turbo_method: :delete,
                      turbo_confirm: "本当に削除しますか？" } %>
      </div>
    </div>
  <% end %>

    <!-- 下ナビ（2×2レイアウト） -->
  <nav class="nav-grid">
    <%= link_to "道しるべを見る", roadmap_path, class: "nav-button" %>
    <%= link_to "振り返りを見る", reviews_path, class: "nav-button" %>
    <%= link_to "My page", mypage_path, class: "nav-button" %>
    <%= link_to "ログアウト", destroy_user_session_path,
                data: { turbo_method: :delete, turbo_confirm: "ログアウトしますか？" },
                class: "nav-button" %>
  </nav>
</div>