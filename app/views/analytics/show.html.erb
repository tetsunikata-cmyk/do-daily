<div class="page">
  <!-- 画像どおり「振り返りを見る」タブ -->
  <div class="page-header">振り返りを見る</div>

  <!-- 大きな黒い枠 + グラフ -->
  <div class="black-card">
    <h2>ToDoの実行率など</h2>
    <canvas id="analyticsChart" width="400" height="250"></canvas>
  </div>

  <!-- 数値の一覧もあると安心 -->
  <div class="black-card">
    <h2>直近7日の実行率</h2>
    <ul>
      <% @labels.each_with_index do |label, i| %>
        <li><%= label %> … <%= @rates[i] %>%</li>
      <% end %>
    </ul>
  </div>

    <!-- 下ナビ（2×2レイアウト） -->
   <nav class="nav-grid">
    <%= link_to "道しるべを見る", roadmap_path, class: "nav-button" %>
    <%= link_to "振り返りを見る", reviews_path, class: "nav-button" %>
    <%= link_to "My page", mypage_path, class: "nav-button" %>
    <%= link_to "ログアウト", destroy_user_session_path,
                data: { turbo_method: :delete, turbo_confirm: "ログアウトしますか？" },
                class: "nav-button" %>
  </nav>
</div>

<script>
  // Turbo 有効時でも動くように
  document.addEventListener("turbo:load", setupAnalyticsChart);
  document.addEventListener("DOMContentLoaded", setupAnalyticsChart);

  function setupAnalyticsChart() {
    var canvas = document.getElementById("analyticsChart");
    if (!canvas) return; // このページじゃなければ何もしない

    var ctx = canvas.getContext("2d");

    var labels = <%= raw @labels.to_json %>;
    var data   = <%= raw @rates.to_json %>;

    new Chart(ctx, {
      type: "line",
      data: {
        labels: labels,
        datasets: [{
          label: "実行率（%）",
          data: data,
          fill: false,
          tension: 0.2
        }]
      },
      options: {
        scales: {
          y: {
            min: 0,
            max: 100,
            ticks: {
              stepSize: 20
            }
          }
        }
      }
    });
  }
</script>